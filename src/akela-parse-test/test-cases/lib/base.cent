element TestSuite {
  properties {
    name: String `required`
    solo: Bool      # only run this suite
    mute: Bool      # exclude this suite from running
  }
}

element Test {
  properties {
    name: String `required`
    solo: Bool      # only run this test
    mute: Bool      # exclude this test from running
    snapshot: Bool  # output snapshot
    has_error: Bool `required`
    errors: Errors
  }
}

element Errors {
  children {
    Error
  }
}

element Error {
  properties {
    message: String
    start_pos: Integer
    end_pos: Integer
    line: Integer
    col: Integer
  }
}

element Ast(AstType) {
  properties {
    value: String
    tu: TypeDef
  }
  children {
    Ast
  }
}

enum AstType {
  None
  Id
  Sign
  Number
  String
  Assign
  Plus
  Minus
  Mult
  Divide
  Stmts
  Function
  Dseq
  Dret
  Call
  Cseq
  If
  ConditionalBranch
  DefaultBranch
  Equality
  NotEqual
  LessThan
  LessThanOrEqual
  GreaterThan
  GreaterThanOrEqual
  Not
  And
  Or
  While
  ForRange
  ForIteration
  Declaration
  ArrayLiteral
  ArraySubscript
  Boolean
  Parenthesis
  Type
  Power
  Type_pool
  Dot
  Struct
  Return
  Eseq
  Error
  Prototype
  Extern
  StructLiteral
  StructLiteralField
  Ellipsis
  Impl
  Self
  Const
  Var
}

enum TypeDefType {
  None
  Integer
  Natural
  Real
  Boolean
  Struct
  Array
  ArrayConst
  Slice
  Pointer
  Function
}

element TypeDef(TypeDefType) {
  properties {
    name: String `required`
  }
}

variant TypeDef::Integer {
    properties {
        bit_count: Natural
    }
}

variant TypeDef::Natural {
    properties {
        bit_count: Natural
    }
}

variant TypeDef::Real {
    properties {
        bit_count: Natural
    }
}

variant TypeDef::Struct {
    children {
        TypeField
    }
}

element TypeField {
    properties {
        name: String
        tu: TypeDef
    }
}

variant TypeDef::Array {
    properties {
        dim: Natural
        td: TypeDef
    }
}

variant TypeDef::ArrayConst {
    properties {
        dim: Natural
        td: TypeDef
    }
}

variant TypeDef::Slice {
    properties {
        td: TypeDef
    }
}

variant TypeDef::Pointer {
    properties {
        td: TypeDef
    }
}

variant TypeDef::Function {
    properties {
        input: Input
        output: TypeDef
    }
}

element Input {
    children {
        TypeParam
    }
}

element TypeParam {
    properties {
        name: String
        tu: TypeDef
    }
}