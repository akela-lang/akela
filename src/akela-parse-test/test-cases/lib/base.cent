element TestSuite {
  properties {
    name: String `required`
    solo: Bool      # only run this suite
    mute: Bool      # exclude this suite from running
  }
}

element Test {
  properties {
    name: String `required`
    solo: Bool      # only run this test
    mute: Bool      # exclude this test from running
    snapshot: Bool  # output snapshot
    has_error: Bool `required`
  }
}

element Errors {
  children {
    Error
  }
}

element Error {
  properties {
    message: String
    start: Integer
    end: Integer
    line: Integer
    col: Integer
  }
}

element Ast(AstType) {
  properties {
    value: String
    type: Type
  }
  children {
    Ast
  }
}

enum AstType {
  None
  Id
  Sign
  Number
  String
  Assign
  Plus
  Minus
  Mult
  Divide
  Stmts
  Function
  Dseq
  Dret
  Call
  If
  ConditionalBranch
  DefaultBranch
  Equality
  NotEqual
  LessThan
  LessThanOrEqual
  GreaterThan
  GreaterThanOrEqual
  Not
  And
  Or
  While
  ForRange
  ForIteration
  Declaration
  ArrayLiteral
  ArraySubscript
  Boolean
  Parenthesis
  Type
  Power
  Type_pool
  Dot
  Struct
  Return
  Prototype
  Extern
  StructLiteral
  StructLiteralField
  Ellipsis
  Impl
  Const
  Var
}

variant Ast::Id {
    properties {
        value: String
    }
}

variant Ast::Sign {
    properties {
        op: Ast
        right: Ast
    }
}

variant Ast::Number {
    properties {
        value: String
    }
}

variant Ast::Assign {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Plus {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Minus {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Mult {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Divide {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Stmts {
    children {
        Ast
    }
}

variant Ast::Function {
    properties {
        proto: Ast
        body: Ast
    }
}

variant Ast::Dret {
    properties {
        node: Ast
    }
}

variant Ast::Call {
    properties {
        func: Ast
        args: AstList
    }
}

variant Ast::If {
    children {
        Ast
    }
}

variant Ast::ConditionalBranch {
    properties {
        cond: Ast
        body: Ast
    }
}

variant Ast::DefaultBranch {
    properties {
        body: Ast
    }
}

variant Ast::Equality {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::NotEqual {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::LessThan {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::LessThanOrEqual {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::GreaterThan {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::GreaterThanOrEqual {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Not {
    properties {
        right: Ast
    }
}

variant Ast::And {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::Or {
    properties {
        left: Ast
        right: Ast
    }
}

variant Ast::While {
    properties {
        cond: Ast
        body: Ast
    }
}

variant Ast::ForRange {
    properties {
        dec: Ast
        start: Ast
        end: Ast
        body: Ast
    }
}

variant Ast::ForIteration {
    properties {
        dec: Ast
        iterator: Ast
        body: Ast
    }
}

variant Ast::Declaration {
    properties {
        id: Ast
        type: Ast
    }
}

element AstList {
    children {
        Ast
    }
}

enum TypeKind {
  None
  Integer
  Natural
  Real
  Boolean
  Struct
  Array
  Slice
  Pointer
  Function
}

element Type(TypeKind) {
  properties {
    name: String `required`
  }
}

variant Type::Integer {
    properties {
        bit_count: Natural
    }
}

variant Type::Natural {
    properties {
        bit_count: Natural
    }
}

variant Type::Real {
    properties {
        bit_count: Natural
    }
}

variant Type::Struct {
    children {
        TypeField
    }
}

element TypeField {
    properties {
        name: String
        type: Type
    }
}

variant Type::Array {
    properties {
        is_const: Bool
        dim: Natural
        type: Type
    }
}

variant Type::Slice {
    properties {
        type: Type
    }
}

variant Type::Pointer {
    properties {
        type: Type
    }
}

variant Type::Function {
    properties {
        input: Input
        output: Type
    }
}

element Input {
    children {
        TypeParam
    }
}

element TypeParam(TypeParamKind) {
    properties {
        name: String
        type: Type
    }
}

enum TypeParamKind {
    Regular
    Ellipsis
}